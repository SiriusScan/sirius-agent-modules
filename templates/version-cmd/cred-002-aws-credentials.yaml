id: CRED-002
info:
  name: AWS Credentials Unprotected
  vulnerability_id: CWE-732
  version: "1.0.0"
  author: "Sirius Team"
  severity: high
  description: "Detects AWS credentials file with overly permissive permissions. The ~/.aws/credentials file should only be readable by the owner (mode 600) to prevent unauthorized access to AWS access keys."
  cwe:
    - CWE-732
  references:
    - https://cwe.mitre.org/data/definitions/732.html
    - https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html
    - https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html
  tags:
    - credentials
    - aws
    - cloud
    - permissions
    - hardening
  remediation: "Set AWS credentials file permissions to 600 using 'chmod 600 ~/.aws/credentials'. Consider using IAM roles or AWS SSO instead of long-term access keys. Rotate any potentially compromised credentials."

detection:
  logic: any
  steps:
    - name: "Check AWS credentials permissions"
      type: version_cmd
      platforms:
        - linux
        - darwin
      weight: 1.0
      config:
        command:
          [
            "sh",
            "-c",
            "test -f ~/.aws/credentials && ls -la ~/.aws/credentials | grep -v '^-rw-------'",
          ]
        regex: "credentials"
